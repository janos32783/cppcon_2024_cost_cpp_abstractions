#pragma once

#include <cstdint>
#include <concepts>

namespace hal {
namespace nvic {

// TODO : why is there 3 defined in SVD but 2 used in the firmware?
constexpr std::uint32_t nvic_prio_bits { 2 }; // 2 nvic prio bits

// NVIC register base addresses
{{data_prefix}} {{data_type}} {{nvic["base_address_name"]}} = {{data_macro}}({{nvic["address"]}});

template <{{data_type}} base_addr>
concept is_valid_base_address = (
    base_addr == {{nvic["base_address_name"]}}
);

{%- for register in nvic["registers"] %}
{{data_prefix}} {{data_type}} STK_{{register["name"]}}_OFFSET{{" " * (12 - register["name"]|length)}} = {{data_macro}}({{register["offset"]}});
{%- endfor %}

{%- for register in nvic["registers"] %}
// {{register["description"]}}
{%- for field in register["fields"] %}
{{data_prefix}} {{data_type}} {{nvic["name"]}}_{{register["name"]}}_{{field["name"]}}_MSK{{" " * (10 - field["name"]|length)}} = {{data_macro}}({{field["bitmask"]}});
{{data_prefix}} {{data_type}} {{nvic["name"]}}_{{register["name"]}}_{{field["name"]}}_POS{{" " * (10 - field["name"]|length)}} = {{data_macro}}({{field["offset"]}});
{%- endfor %}
{%- endfor %}

} /* namespace nvic */
} /* namespace hal */